{% load crispy_forms_tags %}
{% load static %}
{% load parse_var %}

<style>
    .toggle__dot {
        top: -.25rem;
        left: -.25rem;
        transition: all 0.3s ease-in-out;
    }

    input:checked ~ .toggle__dot {
        transform: translateX(100%);
        background-color: #48bb78;
    }

    canvas {
        height: 0px;
        transition: all 0.3s ease-in-out;
    }
</style>

<div class="w-3/4 mx-auto mb-10">
    <div class="justify-center mx-auto bg-white shadow-lg md:w-4/5 md:px-3 rounded-3xl py-1">
        <p class="py-4 text-xl font-bold bg-white pb-7">
            Student Data Collection Progress
        </p>
        <div class="w-3/4 mx-auto pb-7 text-left text-gray-700">
            <form action="{% url 'datacollection:preference_set_form_open' %}" method="POST">
                {% csrf_token %}
                {{ open_new_preference_form|crispy }}
                <button class="inline-flex justify-center px-4 py-2 text-sm font-medium text-white bg-indigo-600 border border-transparent rounded-md shadow-sm hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 w-full">
                    Open
                </button>
            </form>
        </div>
        {% for preference_form in all_preference_forms %}
            {% if preference_form.is_active %}
                <div class="mx-auto my-6">
                    <div class="m-3 rounded shadow-lg p-3 bg-gray-100 mx-auto">
                        <div class="relative flex flex-col md:flex-row justify-between pb-1">
                        <span class="absolute cursor-pointer right-0 rotate-45 text-2xl top-0 transform">
                            <form action="{% url 'datacollection:preference_set_form_open_close' preference_form.id 'remove' %}"
                                  method="POST">
                                    {% csrf_token %}
                                    <button class="focus:outline-none outline-none">âœ›</button>
                                </form>

                        </span>
                            <div class="w-full md:w-1/3 m-auto">
                                <p class="text-2xl text-center font-bold py-4 px-2">
                                    <a
                                            href="{{ preference_form.form_link }}">{{ preference_form.name.capitalize }}
                                        |
                                        <span class="text-gray-600">{{ preference_form.set }}</span>
                                    </a>
                                    {% if preference_form.is_taking_responses %}
                                        <form action="{% url 'datacollection:preference_set_form_open_close' preference_form.id 'close' %}"
                                              method="POST">
                                            {% csrf_token %}
                                            <button class="h-10 px-5 m-2 text-red-100 transition-colors duration-150 bg-red-700 rounded-lg focus:shadow-outline hover:bg-red-800">
                                                Close
                                            </button>
                                        </form>
                                    {% else %}
                                        <form action="{% url 'datacollection:preference_set_form_open_close' preference_form.id 'open' %}"
                                              method="POST">
                                            {% csrf_token %}
                                            <button class="h-10 px-5 m-2 text-green-100 transition-colors duration-150 bg-green-700 rounded-lg focus:shadow-outline hover:bg-green-800">
                                                Open
                                            </button>
                                        </form>
                                    {% endif %}
                                </p>

                            </div>
                            <div>
                                <div class="flex flex-wrap justify-center text-center">
                                    <div class="py-1 px-4">
                                        <p class="p-6 text-2xl font-medium">{{ preference_form.response_entries.0 }}</p>
                                        <p class="text-gray-500 text-xl">Responses</p>
                                        <p class="text-green-400 text-base">{{ preference_form.response_entries.1 }}% <i
                                                class="ml-2 fa fa-thumbs-up"></i></p>
                                    </div>
                                    <div class="py-1 px-4">
                                        <p class="p-6 text-2xl font-medium">{{ preference_form.no_response_entries.0 }}</p>
                                        <p class="text-gray-500 text-xl">No Response</p>
                                        <p class="text-red-400 text-base">{{ preference_form.no_response_entries.1 }}%
                                            <i
                                                    class="ml-2 fa fa-ban"></i></p>
                                    </div>
                                    <div class="py-1 px-4">
                                        <p class="p-6 text-2xl font-medium">{{ preference_form.total_students }}</p>
                                        <p class="text-gray-500 text-xl">Total</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% get_course_stats preference_form as stat_list %}

                        <button class="w-full h-10 text-white outline-none focus:outline-none"
                                onclick="createChart('{{ preference_form.id }}',[
                                        {% for stat in stat_list %}'{{ stat.course }}',{% endfor %}
                                        ],[
                                        {% for stat in stat_list %}{{ stat.count }},{% endfor %}
                                        ])">
                            <span class="text-gray-800">Stats</span> <i
                                class="fa fa-chevron-circle-down text-gray-800"></i>
                        </button>
                        <div>
                            <!-- id dynamic hogi -->
                            <canvas id="{{ preference_form.id }}"></canvas>
                        </div>
                    </div>
                </div>
            {% endif %}
        {% endfor %}
    </div>
</div>
